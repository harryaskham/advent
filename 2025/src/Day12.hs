module Day12 (part1) where

part1 :: ℤ
part1 =
  let (ps, rs) :: [(ℤ, ".#" ▦ ℤ²)] × [(ℤ², [ℤ])] = $(aoc 12) & (⊏|⊐) @(([(ℤ, ".#" ▦ ℤ²) ⯻ ":\n"] ≠ []) × ([(ℤ² ⯻ "x", [ℤ] ⯻ " ") ⯻ ": "] ≠ []))
      vs = uniq ∘ (((⌞) ∘) <$> ((∘) <$> [id, (↻), ((↻)) ∘ ((↻)), ((↺))] <*> [id, ((◓)), ((◐))]) <*>) ∘ (#) ∘ (⊐) @Set ∘ (|?> (#"#" □)) ∘ snd <$> ps
      go Φ = False
      go ((((w, h), ns), ((x, y), s)) :<!! q) =
        traceShape s $
          all (≡ 0) ns
            ∨ ((ⵉ [n ⋅ (((vs !! i) ⟒) |.|) | (i, n) <- (ns ..#)] |≤| s) ∧ (go (((\((_, ns), (_, s)) -> (ⵉ (ns <&> (^ 2)), -(s |.|))), [(((w, h), ns'), (x ∈ (0 ⥅ w - 3) ??? (x + 1, y) $ (0, y + 1), s')) | (ns', s') <- (ns, s) : [(ns !. (i, n - 1), s ∖ v) | (i, n) <- (ns ..#), n > 0, v <- vs !! i <&> (⇆⇅ (x, y)), v ∩ s ≡ v]]) ||-> q)))
            ∨ go q
   in rs |?| (go ∘ mkℤ₁ ∘ (⇲ (((0, 0),) ∘ mk ∘ box₀ ∘ fst)) ∘ dup)
